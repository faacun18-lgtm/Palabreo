<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Palabra Diaria</title>

<style>
:root {
  --bg: #121213;
  --tile: #3a3a3c;
  --correct: #538d4e;
  --present: #b59f3b;
  --absent: #3a3a3c;
  --border: #565758;
}

* {
  box-sizing: border-box;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

h1 {
  margin: 20px 0 5px;
}

#info {
  opacity: .7;
  margin-bottom: 10px;
}

#board {
  display: grid;
  grid-template-rows: repeat(6, 1fr);
  gap: 8px;
  margin: 20px 0;
}

.row {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 8px;
}

.tile {
  width: 55px;
  height: 55px;
  border: 2px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  font-weight: bold;
  text-transform: uppercase;
}

.tile.filled {
  border-color: #999;
  animation: pop 0.1s ease-in-out;
}

@keyframes pop {
  50% { transform: scale(1.1); }
}

.tile.flip {
  animation: flip 0.6s ease forwards;
}

@keyframes flip {
  0% { transform: rotateX(0); }
  50% { transform: rotateX(90deg); }
  100% { transform: rotateX(0); }
}

.correct { background: var(--correct); border-color: var(--correct); }
.present { background: var(--present); border-color: var(--present); }
.absent  { background: var(--absent); }

#keyboard {
  margin-top: auto;
  padding-bottom: 20px;
}

.key-row {
  display: flex;
  justify-content: center;
  margin-bottom: 8px;
}

.key {
  background: #818384;
  color: black;
  border-radius: 4px;
  margin: 0 3px;
  padding: 12px;
  min-width: 32px;
  text-align: center;
  font-weight: bold;
  cursor: pointer;
  user-select: none;
  transition: transform .1s;
}

.key:active {
  transform: scale(0.95);
}

.key.correct { background: var(--correct); color: white; }
.key.present { background: var(--present); color: white; }
.key.absent  { background: #3a3a3c; color: white; }

#modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  display: none;
  align-items: center;
  justify-content: center;
}

#modal .box {
  background: #1a1a1b;
  padding: 25px;
  border-radius: 10px;
  text-align: center;
}

#modal button {
  margin-top: 15px;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  font-size: 1rem;
  cursor: pointer;
}
</style>
</head>

<body>

<h1>Palabra Diaria</h1>
<div id="info">6 intentos Â· 5 letras</div>

<div id="board"></div>

<div id="keyboard"></div>

<div id="modal">
  <div class="box">
    <h2 id="modal-title"></h2>
    <p id="modal-text"></p>
    <button onclick="location.reload()">Aceptar</button>
  </div>
</div>

<script>
/* ======================
   CONFIG
====================== */
const WORD = "RACHA"; // luego lo hacemos diario
const MAX_ROWS = 6;
const WORD_LEN = 5;

/* ======================
   STATE
====================== */
let row = 0;
let col = 0;
let board = [];

/* ======================
   INIT
====================== */
const boardEl = document.getElementById("board");
for (let r = 0; r < MAX_ROWS; r++) {
  const rowEl = document.createElement("div");
  rowEl.className = "row";
  board[r] = [];
  for (let c = 0; c < WORD_LEN; c++) {
    const tile = document.createElement("div");
    tile.className = "tile";
    rowEl.appendChild(tile);
    board[r][c] = tile;
  }
  boardEl.appendChild(rowEl);
}

const keyboardLayout = [
  "QWERTYUIOP",
  "ASDFGHJKL",
  "â†µZXCVBNMâŒ«"
];

const keyboardEl = document.getElementById("keyboard");

keyboardLayout.forEach(line => {
  const row = document.createElement("div");
  row.className = "key-row";
  [...line].forEach(k => {
    const key = document.createElement("div");
    key.className = "key";
    key.textContent = k;
    key.onclick = () => handleKey(k);
    row.appendChild(key);
  });
  keyboardEl.appendChild(row);
});

/* ======================
   INPUT
====================== */
function handleKey(key) {
  if (document.getElementById("modal").style.display === "flex") return;

  if (key === "âŒ«") {
    if (col > 0) {
      col--;
      board[row][col].textContent = "";
      board[row][col].classList.remove("filled");
    }
    return;
  }

  if (key === "â†µ") {
    if (col === WORD_LEN) submitRow();
    return;
  }

  if (col < WORD_LEN && /^[A-ZÃ‘]$/.test(key)) {
    board[row][col].textContent = key;
    board[row][col].classList.add("filled");
    col++;
  }
}

/* ======================
   CORE (BUG FIXED)
====================== */
function submitRow() {
  const guess = board[row].map(t => t.textContent).join("");

  const result = [];
  const letters = WORD.split("");

  for (let i = 0; i < WORD_LEN; i++) {
    if (guess[i] === WORD[i]) {
      result[i] = "correct";
      letters[i] = null;
    }
  }

  for (let i = 0; i < WORD_LEN; i++) {
    if (!result[i]) {
      const idx = letters.indexOf(guess[i]);
      result[i] = idx !== -1 ? "present" : "absent";
      if (idx !== -1) letters[idx] = null;
    }
  }

  // ðŸ”¥ ACÃ SE PINTA LA FILA ACTUAL (FIX)
  board[row].forEach((tile, i) => {
    setTimeout(() => {
      tile.classList.add("flip");
      setTimeout(() => tile.classList.add(result[i]), 300);
    }, i * 120);
  });

  if (guess === WORD) {
    endGame(true);
    return;
  }

  row++;
  col = 0;

  if (row === MAX_ROWS) {
    endGame(false);
  }
}

/* ======================
   END
====================== */
function endGame(win) {
  setTimeout(() => {
    document.getElementById("modal").style.display = "flex";
    document.getElementById("modal-title").textContent =
      win ? "Â¡Ganaste! ðŸŽ‰" : "Perdiste ðŸ˜¢";
    document.getElementById("modal-text").textContent =
      win ? "Bien jugado" : `La palabra era ${WORD}`;
  }, 1200);
}
</script>

</body>
  </html>
